{% set bridge_ports = [] %}
{% set global_vlan_list = [] %}
{% set vlan_list = [] %}

auto eth0
iface eth0 inet dhcp
 vrf mgmt

auto vagrant
iface vagrant inet dhcp

auto mgmt
iface mgmt
  address 127.0.0.1/8
  vrf-table auto

{# The next block of code will save all of the assigned VLANs to a
global variable of "global_vlan_list." We will use this variable to
populate the VLAN Aware Bridge at the end of this file

{% for interface in node[inventory_hostname]["ports"] %}
{% if node[inventory_hostname]["switching"][interface] is defined %}
{% for vlan2 in node[inventory_hostname]["switching"][interface]["vlans"] %}
{% do global_vlan_list.append(vlan2) %}
{% endfor %}
{% endif %}
{% endfor %}
#}

{%- for interface in node[inventory_hostname]["ports"] -%}
auto {{interface}}
iface {{interface}}
{% endfor %}

{% for lagports in node[inventory_hostname]["mlag"][members] -%}
auto peerlink
iface peerlink {{ lagports }}

{% endfor %}

{% for vlanint in node[inventory_hostname]["routing"]["svi"] -%}
auto {{vlanint}}
iface {{vlanint}}
    address {{ node[inventory_hostname]["routing"]["svi"][vlanint]["ip"] }}
    vlan-id {{ node[inventory_hostname]["routing"]["svi"][vlanint]["vlan"] }}
    vlan-raw-device bridge
    address-virtual {{ node[inventory_hostname]["routing"]["svi"][vlanint]["vrrp"]["ip"] }} {{ node[inventory_hostname]["routing"]["svi"][vlanint]["vrrp"]["mac"] }}
{% endfor %}

{#
{% if global_vlan_list != [] %}
auto bridge
iface bridge
    bridge-ports {{ bridge_ports | unique | sort | join(" ") }}
    bridge-pvid 1
    bridge-vids {{ global_vlan_list | unique | sort | join(" ") }}
    bridge-vlan-aware yes
{% endif %}
#}
